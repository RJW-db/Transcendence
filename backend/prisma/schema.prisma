generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./database/pong_tournament.db"
}

model User {
  ID             Int      @id @default(autoincrement())
  Alias          String   @unique
  Email          String   @unique
  Secret2FA      String
  Password       String?
  OauthLogin     Boolean @default(false)
  Online         Boolean @default(true)
  CreationDate   DateTime
  GamesWon       Int      @default(0)
  ProfilePicture Bytes?
  BlockedBy      BlockedUser[] @relation("BlockedBy")
  Blocked        BlockedUser[] @relation("Blocked")
  Friends1       Friend[]      @relation("User1")
  Friends2       Friend[]      @relation("User2")
  InvitationsSent Invitation[] @relation("Sender")
  InvitationsReceived Invitation[] @relation("Receiver")
  matchesAsPlayer1       Match[]       @relation("Player1")
  matchesAsPlayer2       Match[]       @relation("Player2")
  matchesAsWinner        Match[]       @relation("Winner")
  MessagesSent   Message[]     @relation("Sender")
  MessagesReceived Message[]   @relation("Receiver")
  Cookies        Cookie[]
  TournamentUsers TournamentUser[]
}

model BlockedUser {
  ID         Int      @id @default(autoincrement())
  BlockerID  Int
  BlockedID  Int
  BlockedDate DateTime
  Blocker    User     @relation("BlockedBy", fields: [BlockerID], references: [ID])
  Blocked    User     @relation("Blocked", fields: [BlockedID], references: [ID])
  @@unique([BlockerID, BlockedID])
}

model Friend {
  ID             Int      @id @default(autoincrement())
  User1ID        Int
  User2ID        Int
  DateBefriended DateTime
  User1          User     @relation("User1", fields: [User1ID], references: [ID])
  User2          User     @relation("User2", fields: [User2ID], references: [ID])
  @@unique([User1ID, User2ID])
}

model Invitation {
  ID          Int      @id @default(autoincrement())
  SenderID    Int
  ReceiverID  Int
  Status      Int
  SentAt      DateTime
  RespondedAt DateTime?
  MatchID     Int
  Sender      User     @relation("Sender", fields: [SenderID], references: [ID])
  Receiver    User     @relation("Receiver", fields: [ReceiverID], references: [ID])
  Match       Match    @relation(fields: [MatchID], references: [ID])
}

model Log {
  UUID            Int      @id @default(autoincrement())
  DateTime        DateTime
  Type            Int
  ServerClientID  Int
  Message         String
}

model Match {
  ID            Int      @id @default(autoincrement())
  Player1ID     Int
  Player2ID     Int
  Player1Score  Int
  Player2Score  Int
  CreationDate  DateTime
  WinnerID      Int?
  Player1       User     @relation("Player1", fields: [Player1ID], references: [ID])
  Player2       User     @relation("Player2", fields: [Player2ID], references: [ID])
  Winner        User?    @relation("Winner", fields: [WinnerID], references: [ID])
  Invitations   Invitation[]
}

model Message {
  ID         Int      @id @default(autoincrement())
  SenderID   Int
  ReceiverID Int
  Message    String
  DateTime   DateTime
  IsRead     Boolean
  Sender     User     @relation("Sender", fields: [SenderID], references: [ID])
  Receiver   User     @relation("Receiver", fields: [ReceiverID], references: [ID])
}

model Tournament {
  ID           Int      @id @default(autoincrement())
  Name         String
  CreationDate DateTime
  WinnerID     Int?
  Winner       TournamentUser? @relation("TournamentWinner", fields: [WinnerID], references: [ID])
  Matches      TournamentMatch[]
  Users        TournamentUser[] @relation("TournamentParticipants")
  TournamentUsers TournamentUser[] @relation("TournamentToUser")
}

model TournamentMatch {
  ID            Int      @id @default(autoincrement())
  TournamentID  Int
  Player1ID     Int
  Player2ID     Int
  Player1Score  Int
  Player2Score  Int
  CreationDate  DateTime
  WinnerID      Int?
  Tournament    Tournament     @relation(fields: [TournamentID], references: [ID])
  Player1       TournamentUser @relation("Player1", fields: [Player1ID], references: [ID])
  Player2       TournamentUser @relation("Player2", fields: [Player2ID], references: [ID])
  Winner        TournamentUser? @relation("Winner", fields: [WinnerID], references: [ID])
}

model TournamentUser {
  ID           Int      @id @default(autoincrement())
  Alias        String
  UserID       Int
  TournamentID Int
  User         User     @relation(fields: [UserID], references: [ID])
  Tournament   Tournament @relation("TournamentToUser", fields: [TournamentID], references: [ID])
  matchesAsPlayer1     TournamentMatch[] @relation("Player1")
  matchesAsPlayer2     TournamentMatch[] @relation("Player2")
  matchesAsWinner      TournamentMatch[] @relation("Winner")
  tournaments          Tournament[] @relation("TournamentParticipants")
  tournamentsAsWinner  Tournament[] @relation("TournamentWinner")
}

model Cookie {
  CookieValue String @id
  UserID      Int
  User        User   @relation(fields: [UserID], references: [ID])
}
